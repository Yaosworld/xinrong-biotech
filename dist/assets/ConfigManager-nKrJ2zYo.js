import{B as H,l as p,c as $,d as P,o as A,a as k,e as i,f as K,b as r,w as d,F,r as U,x as g,h as z,C as q,t as x,i as N,q as G,H as Q,u as J,E as b,k as w,G as W,_ as X}from"./index-1ucue018.js";import{u as Y}from"./adminStore-BeShUQl2.js";const Z=H("config",()=>{const v=p(null),s=p(new Map),u=p([]),y=p(!1),o=p(null),c=p(!1),C=$(()=>u.value.length),h=$(()=>u.value.length>0?u.value[0]:null);function S(t){const n=JSON.stringify(t);let e=0;for(let m=0;m<n.length;m++){const B=n.charCodeAt(m);e=(e<<5)-e+B,e=e&e}return Math.abs(e).toString(16).padStart(8,"0")}async function j(){y.value=!0,o.value=null;try{const t=await fetch("/data/site-info.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return v.value=await t.json(),v.value}catch(t){return o.value=t instanceof Error?t.message:"加载网站配置失败",null}finally{y.value=!1}}async function M(t){if(s.value.has(t))return s.value.get(t);y.value=!0,o.value=null;try{const n=await fetch(`/data/pages/${t}.json`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const e=await n.json();return s.value.set(t,e),e}catch(n){return o.value=n instanceof Error?n.message:`加载页面配置 ${t} 失败`,null}finally{y.value=!1}}function V(t){v.value&&(v.value={...v.value,...t},c.value=!0)}function E(t,n){const e=s.value.get(t);e&&(s.value.set(t,{...e,...n}),c.value=!0)}function l(t,n){const e={id:Date.now().toString(),type:t,data:JSON.parse(JSON.stringify(n)),timestamp:new Date().toISOString(),checksum:S(n)};return u.value.unshift(e),u.value.length>10&&(u.value=u.value.slice(0,10)),O(),e}function a(t){const n=u.value.find(e=>e.id===t);return n?S(n.data)!==n.checksum?(o.value="备份数据校验失败",null):n.data:(o.value="找不到指定的备份",null)}function f(t){u.value=u.value.filter(n=>n.id!==t),O()}function O(){try{localStorage.setItem("config_backups",JSON.stringify(u.value))}catch(t){console.error("保存备份失败:",t)}}function L(){try{const t=localStorage.getItem("config_backups");t&&(u.value=JSON.parse(t))}catch(t){console.error("加载备份失败:",t)}}function T(t,n){let e=null;return t==="site"?e=v.value:t==="page"&&n&&(e=s.value.get(n)),e?JSON.stringify(e,null,2):(o.value="没有可导出的配置",null)}function _(t,n,e){try{const m=JSON.parse(n);if(t==="site")v.value&&l("site",v.value),v.value=m;else if(t==="page"&&e){const B=s.value.get(e);B&&l(`page-${e}`,B),s.value.set(e,m)}return c.value=!0,!0}catch{return o.value="JSON格式无效",!1}}function D(){L()}function R(){c.value=!1}return{siteConfig:v,pageConfigs:s,backups:u,loading:y,error:o,isDirty:c,backupCount:C,latestBackup:h,loadSiteConfig:j,loadPageConfig:M,updateSiteConfig:V,updatePageConfig:E,createBackup:l,restoreFromBackup:a,deleteBackup:f,exportConfig:T,importConfig:_,init:D,markSaved:R}}),I={class:"config-manager"},ee={class:"bg-white rounded-xl shadow-sm p-6 mb-6"},te={class:"flex flex-wrap items-center gap-4"},ne={class:"flex items-center"},ae={class:"bg-white rounded-xl shadow-sm overflow-hidden"},oe={class:"bg-gray-100 px-4 py-2 border-b flex items-center justify-between"},se={class:"text-sm text-gray-600"},le={key:0,class:"mt-6 bg-white rounded-xl shadow-sm p-6"},re={class:"text-lg font-semibold text-gray-800 mb-4"},ie={class:"space-y-2"},ue={class:"font-medium text-gray-700"},ce={class:"text-sm text-gray-400 ml-4"},fe=P({__name:"ConfigManager",setup(v){const s=Z(),u=Y(),y=[{value:"site-info",label:"网站信息",icon:"House"},{value:"home",label:"首页配置",icon:"HomeFilled"},{value:"product-center",label:"产品中心",icon:"Box"},{value:"brand-center",label:"品牌中心",icon:"Star"},{value:"news-center",label:"资讯中心",icon:"Bell"},{value:"about",label:"关于我们",icon:"InfoFilled"}],o=p("site-info"),c=p(""),C=p(!1),h=async()=>{C.value=!0;try{let l=null;o.value==="site-info"?l=await s.loadSiteConfig():l=await s.loadPageConfig(o.value),l?c.value=JSON.stringify(l,null,2):c.value=""}catch(l){b.error("加载配置失败"),console.error(l)}finally{C.value=!1}},S=async()=>{try{const l=JSON.parse(c.value);s.createBackup(o.value,l),j(),b.success("配置已保存，请下载并替换对应文件"),u.addActivity({type:"config",target:o.value,description:`修改了 ${o.value} 配置`})}catch{b.error("JSON格式错误，请检查")}},j=()=>{const l=new Blob([c.value],{type:"application/json"}),a=URL.createObjectURL(l),f=document.createElement("a");f.href=a,f.download=`${o.value}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(a)},M=async()=>{try{await W.confirm("确定要重置当前配置吗？未保存的更改将丢失","提示",{type:"warning"}),await h(),b.success("配置已重置")}catch{}},V=()=>{try{const l=JSON.parse(c.value);c.value=JSON.stringify(l,null,2),b.success("JSON已格式化")}catch{b.error("JSON格式错误，无法格式化")}},E=()=>{h()};return A(()=>{s.init(),h()}),(l,a)=>{const f=g("el-icon"),O=g("el-option"),L=g("el-select"),T=g("Refresh"),_=g("el-button"),D=g("MagicStick"),R=g("RefreshLeft"),t=g("Download"),n=g("el-input");return w(),k("div",I,[a[8]||(a[8]=i("div",{class:"mb-6"},[i("h2",{class:"text-xl font-semibold text-gray-800 mb-2"},"配置管理"),i("p",{class:"text-gray-500"},"编辑网站配置文件，修改后下载并替换对应文件")],-1)),i("div",ee,[i("div",te,[r(L,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:"选择配置类型",style:{width:"200px"},onChange:E},{default:d(()=>[(w(),k(F,null,U(y,e=>r(O,{key:e.value,label:e.label,value:e.value},{default:d(()=>[i("div",ne,[r(f,{class:"mr-2"},{default:d(()=>[(w(),z(q(e.icon)))]),_:2},1024),i("span",null,x(e.label),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),r(_,{onClick:h,loading:C.value},{default:d(()=>[r(f,{class:"mr-1"},{default:d(()=>[r(T)]),_:1}),a[2]||(a[2]=N(" 刷新 ",-1))]),_:1},8,["loading"]),r(_,{onClick:V},{default:d(()=>[r(f,{class:"mr-1"},{default:d(()=>[r(D)]),_:1}),a[3]||(a[3]=N(" 格式化 ",-1))]),_:1}),r(_,{type:"warning",plain:"",onClick:M},{default:d(()=>[r(f,{class:"mr-1"},{default:d(()=>[r(R)]),_:1}),a[4]||(a[4]=N(" 重置 ",-1))]),_:1}),r(_,{type:"primary",onClick:S},{default:d(()=>[r(f,{class:"mr-1"},{default:d(()=>[r(t)]),_:1}),a[5]||(a[5]=N(" 保存并下载 ",-1))]),_:1})])]),i("div",ae,[i("div",oe,[i("span",se,x(o.value)+".json ",1),a[6]||(a[6]=i("span",{class:"text-xs text-gray-400"}," 按 Ctrl+S 快速保存 ",-1))]),r(n,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),type:"textarea",rows:25,placeholder:"配置内容...",class:"config-editor",onKeydown:G(Q(S,["ctrl","prevent"]),["s"])},null,8,["modelValue","onKeydown"])]),J(s).backupCount>0?(w(),k("div",le,[i("h3",re," 配置备份 ("+x(J(s).backupCount)+") ",1),i("div",ie,[(w(!0),k(F,null,U(J(s).backups.slice(0,5),e=>(w(),k("div",{key:e.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[i("div",null,[i("span",ue,x(e.type),1),i("span",ce,x(new Date(e.timestamp).toLocaleString("zh-CN")),1)]),r(_,{type:"primary",text:"",size:"small",onClick:m=>c.value=JSON.stringify(J(s).restoreFromBackup(e.id),null,2)},{default:d(()=>[...a[7]||(a[7]=[N(" 恢复 ",-1)])]),_:1},8,["onClick"])]))),128))])])):K("",!0)])}}}),ge=X(fe,[["__scopeId","data-v-2d177156"]]);export{ge as default};
