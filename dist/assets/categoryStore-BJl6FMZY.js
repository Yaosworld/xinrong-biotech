import{B as C,l,c as d}from"./index-1ucue018.js";const L=C("product",()=>{const c=l([]),u=l(!1),f=l(null),g=l(!1),t=l({search:"",categoryId:"",brand:"",priceRange:[0,999999],inStock:!1,hasDiscount:!1}),v=l("name-asc"),p=d(()=>{const e=c.value.map(r=>r.brand).filter(r=>!!r);return[...new Set(e)].sort()}),m=d(()=>{const e=new Map;return c.value.forEach(r=>{const o=e.get(r.categoryId)||[];o.push(r),e.set(r.categoryId,o)}),e}),y=d(()=>{let e=[...c.value];if(t.value.search){const a=t.value.search.toLowerCase();e=e.filter(i=>{var P,w;return i.name.toLowerCase().includes(a)||i.specs.toLowerCase().includes(a)||i.desc.toLowerCase().includes(a)||((P=i.brand)==null?void 0:P.toLowerCase().includes(a))||((w=i.sku)==null?void 0:w.toLowerCase().includes(a))})}t.value.categoryId&&(e=e.filter(a=>a.categoryId===t.value.categoryId)),t.value.brand&&(e=e.filter(a=>a.brand===t.value.brand));const[r,o]=t.value.priceRange;return(r>0||o<999999)&&(e=e.filter(a=>{const i=a.currentPrice||a.originalPrice||0;return i>=r&&i<=o})),t.value.inStock&&(e=e.filter(a=>(a.stock||0)>0)),t.value.hasDiscount&&(e=e.filter(a=>a.currentPrice&&a.originalPrice&&a.currentPrice<a.originalPrice)),e}),h=d(()=>{const e=[...y.value];switch(v.value){case"name-asc":e.sort((r,o)=>r.name.localeCompare(o.name,"zh-CN"));break;case"name-desc":e.sort((r,o)=>o.name.localeCompare(r.name,"zh-CN"));break;case"price-asc":e.sort((r,o)=>{const a=r.currentPrice||r.originalPrice||0,i=o.currentPrice||o.originalPrice||0;return a-i});break;case"price-desc":e.sort((r,o)=>{const a=r.currentPrice||r.originalPrice||0;return(o.currentPrice||o.originalPrice||0)-a});break}return e}),n=d(()=>{let e=0;return t.value.search&&e++,t.value.categoryId&&e++,t.value.brand&&e++,(t.value.priceRange[0]>0||t.value.priceRange[1]<999999)&&e++,t.value.inStock&&e++,t.value.hasDiscount&&e++,e});async function s(){if(!(g.value&&c.value.length>0)){u.value=!0,f.value=null;try{const e=await fetch("/data/products.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);c.value=await e.json(),g.value=!0}catch(e){f.value=e instanceof Error?e.message:"加载产品数据失败",console.error("加载产品数据失败:",e)}finally{u.value=!1}}}function k(e){return c.value.find(r=>r.id===e)}function I(e){return c.value.filter(r=>r.categoryId===e)}function b(e,r){t.value[e]=r}function B(){t.value={search:"",categoryId:"",brand:"",priceRange:[0,999999],inStock:!1,hasDiscount:!1}}function S(e){v.value=e}return{products:c,loading:u,error:f,initialized:g,filters:t,sortBy:v,allBrands:p,productsByCategory:m,filteredProducts:y,sortedProducts:h,activeFiltersCount:n,loadProducts:s,getProductById:k,getProductsByCategoryId:I,setFilter:b,clearAllFilters:B,setSortBy:S}}),N=C("category",()=>{const c=l([]),u=l(!1),f=l(null),g=l(!1),t=d(()=>{const n=new Map;return c.value.forEach(s=>{n.set(s.id,s)}),n}),v=d(()=>{const n=new Map;return c.value.forEach(s=>{n.set(s.id,s.name)}),n});async function p(){if(!(g.value&&c.value.length>0)){u.value=!0,f.value=null;try{const n=await fetch("/data/categories.json");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);c.value=await n.json(),g.value=!0}catch(n){f.value=n instanceof Error?n.message:"加载分类数据失败",console.error("加载分类数据失败:",n)}finally{u.value=!1}}}function m(n){return t.value.get(n)}function y(n){return v.value.get(n)||"未分类"}function h(n){const s=m(n);return s&&s.imageName?`/images/categories/${s.imageName}`:"/images/common/placeholder.png"}return{categories:c,loading:u,error:f,initialized:g,categoryMap:t,categoryNameMap:v,loadCategories:p,getCategoryById:m,getCategoryName:y,getCategoryImagePath:h}});export{N as a,L as u};
