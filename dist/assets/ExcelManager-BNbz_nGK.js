import{d as A,l as v,a as _,e as t,b as l,w as o,F as k,r as E,x as a,h as S,C as T,t as h,i as y,f as I,k as d,D as M,E as p,G as P}from"./index-1ucue018.js";import{u as F}from"./adminStore-BeShUQl2.js";const X={class:"excel-manager"},G={class:"bg-white rounded-xl shadow-sm p-6 mb-6"},q={class:"flex flex-wrap items-center gap-4 mb-6"},z={class:"flex items-center"},H={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},K={class:"flex items-start"},Q={key:0,class:"bg-white rounded-xl shadow-sm p-6"},W={class:"flex items-center justify-between mb-4"},Y={class:"text-lg font-semibold text-gray-800"},Z={key:0,class:"mt-4 text-center text-gray-500"},ee={key:1,class:"bg-white rounded-xl shadow-sm p-12 text-center"},oe=A({__name:"ExcelManager",setup(te){const w=F(),D=[{value:"products",label:"产品数据",icon:"Box"},{value:"categories",label:"分类数据",icon:"Folder"},{value:"brands",label:"品牌数据",icon:"Star"},{value:"promotions",label:"促销活动",icon:"Bell"}],i=v("products"),b=v(null),s=v([]),f=v(!1),C=async u=>{if(u!=null&&u.raw){b.value=u.raw,f.value=!0;try{const e=await M(()=>import("./xlsx-D_0l8YDs.js"),[]),n=await b.value.arrayBuffer(),r=e.read(n),x=r.SheetNames[0],g=r.Sheets[x],m=e.utils.sheet_to_json(g);s.value=m,p.success(`成功解析 ${m.length} 条数据`),w.addActivity({type:"upload",target:i.value,description:`上传了 ${i.value} Excel文件，包含 ${m.length} 条数据`})}catch(e){p.error("文件解析失败，请检查文件格式"),console.error(e)}finally{f.value=!1}}},N=()=>{if(s.value.length===0){p.warning("没有可下载的数据");return}const u=JSON.stringify(s.value,null,2),e=new Blob([u],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${i.value}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),p.success("JSON文件已下载"),w.addActivity({type:"download",target:i.value,description:`下载了 ${i.value}.json 文件`})},j=async()=>{try{await P.confirm("确定要清空当前解析的数据吗？","提示",{type:"warning"}),b.value=null,s.value=[],p.success("数据已清空")}catch{}},B=()=>s.value.length===0?[]:Object.keys(s.value[0]);return(u,e)=>{const n=a("el-icon"),r=a("el-option"),x=a("el-select"),g=a("Upload"),m=a("el-button"),O=a("el-upload"),V=a("Download"),L=a("Delete"),U=a("InfoFilled"),J=a("el-table-column"),R=a("el-table"),$=a("Document");return d(),_("div",X,[e[6]||(e[6]=t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-semibold text-gray-800 mb-2"},"Excel数据管理"),t("p",{class:"text-gray-500"},"上传Excel文件，转换为JSON数据并下载")],-1)),t("div",G,[t("div",q,[l(x,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=c=>i.value=c),placeholder:"选择数据类型",style:{width:"200px"}},{default:o(()=>[(d(),_(k,null,E(D,c=>l(r,{key:c.value,label:c.label,value:c.value},{default:o(()=>[t("div",z,[l(n,{class:"mr-2"},{default:o(()=>[(d(),S(T(c.icon)))]),_:2},1024),t("span",null,h(c.label),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),l(O,{"show-file-list":!1,accept:".xlsx,.xls","auto-upload":!1,"on-change":C},{default:o(()=>[l(m,{type:"primary",loading:f.value},{default:o(()=>[l(n,{class:"mr-1"},{default:o(()=>[l(g)]),_:1}),e[1]||(e[1]=y(" 上传Excel文件 ",-1))]),_:1},8,["loading"])]),_:1}),l(m,{type:"success",disabled:s.value.length===0,onClick:N},{default:o(()=>[l(n,{class:"mr-1"},{default:o(()=>[l(V)]),_:1}),e[2]||(e[2]=y(" 下载JSON ",-1))]),_:1},8,["disabled"]),l(m,{type:"danger",plain:"",disabled:s.value.length===0,onClick:j},{default:o(()=>[l(n,{class:"mr-1"},{default:o(()=>[l(L)]),_:1}),e[3]||(e[3]=y(" 清空 ",-1))]),_:1},8,["disabled"])]),t("div",H,[t("div",K,[l(n,{class:"text-blue-500 mt-1 mr-3"},{default:o(()=>[l(U)]),_:1}),e[4]||(e[4]=t("div",{class:"text-sm text-blue-700"},[t("p",{class:"font-medium mb-1"},"上传说明"),t("ul",{class:"list-disc list-inside space-y-1 text-blue-600"},[t("li",null,"支持 .xlsx 和 .xls 格式的Excel文件"),t("li",null,"将读取第一个工作表的数据"),t("li",null,"第一行应为表头，后续行为数据"),t("li",null,"下载后的JSON文件需手动替换到 public/data/ 目录")])],-1))])])]),s.value.length>0?(d(),_("div",Q,[t("div",W,[t("h3",Y," 数据预览 (共 "+h(s.value.length)+" 条) ",1)]),l(R,{data:s.value.slice(0,50),stripe:"",border:"","max-height":"500",style:{width:"100%"}},{default:o(()=>[(d(!0),_(k,null,E(B(),c=>(d(),S(J,{key:c,prop:c,label:c,"min-width":"150","show-overflow-tooltip":""},null,8,["prop","label"]))),128))]),_:1},8,["data"]),s.value.length>50?(d(),_("div",Z," 仅显示前50条数据，共 "+h(s.value.length)+" 条 ",1)):I("",!0)])):(d(),_("div",ee,[l(n,{class:"text-6xl text-gray-300 mb-4"},{default:o(()=>[l($)]),_:1}),e[5]||(e[5]=t("p",{class:"text-gray-500"},"上传Excel文件后，数据将在此处预览",-1))]))])}}});export{oe as default};
