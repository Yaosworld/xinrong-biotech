import{B as F,l as c,c as u}from"./index-1ucue018.js";const j=F("promotion",()=>{const i=c([]),f=c(!1),d=c(null),v=c(!1),s=c({search:"",status:"all",dateRange:null,hasDiscount:!1,priceRange:[0,999999],category:"",tags:[]});function g(t){if(!t.start_date||!t.end_date)return{status:"all",statusText:"状态未知"};const a=new Date;a.setHours(0,0,0,0);const r=new Date(t.start_date),e=new Date(t.end_date);return e.setHours(23,59,59,999),a<r?{status:"coming",statusText:"即将开始"}:a>e?{status:"ended",statusText:"已结束"}:{status:"active",statusText:"进行中"}}const o=u(()=>i.value.map(t=>{const{status:a,statusText:r}=g(t);return{...t,status:a,statusText:r}})),y=u(()=>{const t={coming:1,active:2,ended:3,all:4};return[...o.value].sort((a,r)=>{const e=t[a.status||"all"],n=t[r.status||"all"];return e!==n?e-n:a.priority&&r.priority&&a.priority!==r.priority?a.priority-r.priority:a.start_date&&r.start_date?new Date(r.start_date).getTime()-new Date(a.start_date).getTime():0})}),m=u(()=>{let t=[...y.value];if(s.value.search){const e=s.value.search.toLowerCase();t=t.filter(n=>{var l,_;return n.title.toLowerCase().includes(e)||n.summary.toLowerCase().includes(e)||((l=n.description)==null?void 0:l.toLowerCase().includes(e))||((_=n.tags)==null?void 0:_.some(B=>B.toLowerCase().includes(e)))})}if(s.value.status!=="all"&&(t=t.filter(e=>e.status===s.value.status)),s.value.dateRange){const[e,n]=s.value.dateRange;t=t.filter(l=>!l.start_date||!l.end_date?!1:l.start_date>=e&&l.end_date<=n)}const[a,r]=s.value.priceRange;return(a>0||r<999999)&&(t=t.filter(e=>{const n=e.current_price||e.original_price||0;return n>=a&&n<=r})),s.value.hasDiscount&&(t=t.filter(e=>e.current_price&&e.original_price&&e.current_price<e.original_price)),s.value.category&&(t=t.filter(e=>e.category===s.value.category)),s.value.tags.length>0&&(t=t.filter(e=>{var n;return(n=e.tags)==null?void 0:n.some(l=>s.value.tags.includes(l))})),t}),p=u(()=>o.value.filter(t=>t.status==="active")),w=u(()=>o.value.filter(t=>t.status==="coming")),h=u(()=>o.value.filter(t=>t.status==="ended")),P=u(()=>o.value.filter(t=>t.is_featured)),D=u(()=>{const t=i.value.map(a=>a.category).filter(a=>!!a);return[...new Set(t)].sort()}),T=u(()=>{const t=i.value.flatMap(a=>a.tags||[]);return[...new Set(t)].sort()}),R=u(()=>{let t=0;return s.value.search&&t++,s.value.status!=="all"&&t++,s.value.dateRange&&t++,s.value.hasDiscount&&t++,(s.value.priceRange[0]>0||s.value.priceRange[1]<999999)&&t++,s.value.category&&t++,s.value.tags.length>0&&t++,t});async function x(){if(!(v.value&&i.value.length>0)){f.value=!0,d.value=null;try{const t=await fetch("/data/promotions.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);i.value=await t.json(),v.value=!0}catch(t){d.value=t instanceof Error?t.message:"加载促销数据失败",console.error("加载促销数据失败:",t)}finally{f.value=!1}}}function C(t){const a=i.value.find(r=>r.id===t);if(a){const{status:r,statusText:e}=g(a);return{...a,status:r,statusText:e}}}function L(t,a){s.value[t]=a}function S(){s.value={search:"",status:"all",dateRange:null,hasDiscount:!1,priceRange:[0,999999],category:"",tags:[]}}return{promotions:i,loading:f,error:d,initialized:v,filters:s,processedPromotions:o,sortedPromotions:y,filteredPromotions:m,activePromotions:p,comingPromotions:w,endedPromotions:h,featuredPromotions:P,allCategories:D,allTags:T,activeFiltersCount:R,loadPromotions:x,getPromotionById:C,setFilter:L,clearAllFilters:S}});export{j as u};
